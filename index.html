<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AD MeaSURE 1.3</title>
    <style>
        body {
            background: linear-gradient(darkgreen, green);
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        .container {
            background: black;
            padding: 20px;
            border-radius: 10px;
            max-width: 800px;
            margin: auto;
        }
        img {
            display: block;
            margin: 10px auto;
        }
        a {
            color: white;
            font-weight: bold;
            text-decoration: none;
        }
        canvas {
            display: block;
            max-width: 100%;
            margin: auto;
        }
        button {
            margin: 10px;
            padding: 10px;
            background: orange;
            border: none;
            color: black;
            font-weight: bold;
            cursor: pointer;
        }
        footer {
            margin-top: 20px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>AD MeaSURE 1.3</h1>
    <div class="container">
        <img src="https://www.dropbox.com/scl/fi/7ye13ptxczfybxhev0ozo/enhanced_logo-1.jpg?rlkey=kqppdd9ppd4dqgaaqr81fwjak&st=0shocxvr&raw=1" width="150" height="150" alt="Logo">
        <p><a href="https://www.agroindata.com/">www.agroindata.com</a></p>
        <p><strong>Instructions:</strong></p>
        <p>1. Take an image with a measure ruler.<br>
           2. Count 3 cm in the ruler and check how many pixels there are.<br>
           3. Add the number of pixels in the box below and start measuring.<br>
           4. Take a screenshot to share and save the file.</p>
        <p>For any customization, demo, or other requests, please contact us at agroindata@gmail.com</p>
        <input type="file" id="upload" accept="image/*">
        <button onclick="openCamera()">Take a Photo</button>
        <canvas id="canvas"></canvas>
        <p>Add here the number of pixels in 3 cm: <input type="number" id="pixelPerCm"></p>
        <button onclick="undoLast()">UNDO</button>
        <button onclick="confirmRefresh()">Refresh Page</button>
    </div>
    <footer>
        <p>Note: Practice before use. We are currently working to improve this tool. Created by Christian Stange Marcus, AGROinDATA with AI. For more information, contact us directly at agroindata@gmail.com.</p>
    </footer>
    <script>
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let img = new Image();
        let points = [];
        let pixelPerCm = 0;

        document.getElementById('upload').addEventListener('change', function(e) {
            let file = e.target.files[0];
            let reader = new FileReader();
            reader.onload = function(event) {
                img.onload = function() {
                    canvas.width = img.width / 2;
                    canvas.height = img.height / 2;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    overlayLogo();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });

        function overlayLogo() {
            let logo = new Image();
            logo.src = "https://www.dropbox.com/scl/fi/7ye13ptxczfybxhev0ozo/enhanced_logo-1.jpg?rlkey=kqppdd9ppd4dqgaaqr81fwjak&st=0shocxvr&raw=1";
            logo.onload = function() {
                ctx.drawImage(logo, canvas.width / 2 - 25, canvas.height - 50, 50, 50);
            };
        }

        canvas.addEventListener('click', function(event) {
            if (pixelPerCm === 0) {
                pixelPerCm = document.getElementById('pixelPerCm').value / 3;
            }
            let x = event.offsetX;
            let y = event.offsetY;
            points.push({ x, y });
            ctx.fillStyle = 'orange';
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fill();

            if (points.length === 2) {
                ctx.strokeStyle = 'yellow';
                ctx.beginPath();
                ctx.moveTo(points[0].x, points[0].y);
                ctx.lineTo(points[1].x, points[1].y);
                ctx.stroke();
                let pixelDistance = Math.sqrt(Math.pow(points[1].x - points[0].x, 2) + Math.pow(points[1].y - points[0].y, 2));
                let cmDistance = (pixelDistance / pixelPerCm).toFixed(2);
                ctx.fillStyle = 'white';
                ctx.fillText(`${pixelDistance.toFixed(2)} px / ${cmDistance} cm`, (points[0].x + points[1].x) / 2, (points[0].y + points[1].y) / 2);
                points = [];
            }
        });

        function undoLast() {
            location.reload();
        }

        function confirmRefresh() {
            if (confirm("Are you sure that you want to refresh? You might lose all the counts made.")) {
                location.reload();
            }
        }

        function openCamera() {
            document.getElementById('upload').click();
        }
    </script>
</body>
</html>
